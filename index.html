<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PAU-MOVs Dashboard</title>
  <link rel="icon" type="image/png" href="PAU MOVs.png" />
  
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    :root {
      /* Theme Colors */
      --primary: #3b82f6;
      --sidebar-bg: #111827;
      --sidebar-text: #9ca3af;
      --sidebar-active: #3b82f6;
      --bg-color: #f3f4f6;
      
      /* Card Colors (Pastels) */
      --c-iec-bg: #dbeafe; --c-iec-text: #1e40af;
      --c-news-bg: #dcfce7; --c-news-text: #166534;
      --c-photo-bg: #fef3c7; --c-photo-text: #92400e;
      --c-pilu-bg: #e0f2fe; --c-pilu-text: #075985;
      --c-soc-o-bg: #e0e7ff; --c-soc-o-text: #3730a3;
      --c-soc-p-bg: #ccfbf1; --c-soc-p-text: #115e59;
      --c-total-bg: #e5e7eb; --c-total-text: #374151;
    }

    * { margin:0; padding:0; box-sizing:border-box; font-family:'Inter', sans-serif; }
    body { display:flex; height:100vh; background:var(--bg-color); overflow: hidden; }

    /* --- SIDEBAR --- */
    .sidebar {
      width: 260px;
      background: var(--sidebar-bg);
      color: #fff;
      display: flex;
      flex-direction: column;
      flex-shrink: 0;
    }
    .brand { padding: 25px 20px; border-bottom: 1px solid #1f2937; }
    .brand h2 { font-size: 1.25rem; font-weight: 700; color: #fff; margin-bottom: 5px; }
    .brand p { font-size: 0.75rem; color: #6b7280; text-transform: uppercase; letter-spacing: 0.5px; }
    
    .sidebar ul { list-style:none; padding: 20px 10px; flex: 1; }
    .sidebar li {
      padding: 12px 15px;
      margin-bottom: 5px;
      cursor:pointer;
      border-radius: 6px;
      color: var(--sidebar-text);
      font-size: 0.9rem;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 12px;
      transition: all 0.2s;
    }
    .sidebar li:hover { background: rgba(255,255,255,0.05); color: #fff; }
    .sidebar li.active { background: var(--sidebar-active); color: #fff; }
    .sidebar li i { width: 20px; text-align: center; }

    /* --- MAIN CONTENT --- */
    .content { flex:1; padding: 30px; overflow-y:auto; position: relative; }
    
    h1 { font-size: 1.5rem; font-weight: 700; color: #111827; margin-bottom: 5px; }
    p.subtitle { color: #6b7280; font-size: 0.9rem; margin-bottom: 25px; }

    .section { display:none; animation: fadeIn 0.4s ease; }
    .section.active { display:block; }
    @keyframes fadeIn { from { opacity:0; transform: translateY(10px); } to { opacity:1; transform: translateY(0); } }

    /* --- DASHBOARD GRID --- */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      padding: 20px;
      border-radius: 12px;
      position: relative;
      transition: transform 0.2s;
    }
    .stat-card:hover { transform: translateY(-3px); }
    .stat-card h3 { font-size: 0.85rem; font-weight: 600; margin-bottom: 15px; opacity: 0.8; }
    .stat-card .value { font-size: 2rem; font-weight: 700; }
    .stat-card .icon { position: absolute; top: 20px; right: 20px; font-size: 1.2rem; opacity: 0.7; }

    /* Color Variants for Cards */
    .card-iec { background: var(--c-iec-bg); color: var(--c-iec-text); }
    .card-news { background: var(--c-news-bg); color: var(--c-news-text); }
    .card-photo { background: var(--c-photo-bg); color: var(--c-photo-text); }
    .card-pilu { background: var(--c-pilu-bg); color: var(--c-pilu-text); }
    .card-soc-o { background: var(--c-soc-o-bg); color: var(--c-soc-o-text); }
    .card-soc-p { background: var(--c-soc-p-bg); color: var(--c-soc-p-text); }
    .card-total { background: var(--c-total-bg); color: var(--c-total-text); }

    /* --- CHARTS AREA --- */
    .charts-container {
      display: grid;
      grid-template-columns: 1fr 2fr; /* 1/3 for Donut, 2/3 for Bar */
      gap: 20px;
      margin-bottom: 30px;
    }
    .chart-box {
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .chart-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
    .chart-header h4 { font-size: 1rem; font-weight: 600; color: #374151; }

    /* --- FORMS & TABLES --- */
    .panel { background: #fff; padding: 25px; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); margin-bottom: 30px; }
    
    .input-grid { display:grid; grid-template-columns:repeat(auto-fit, minmax(200px,1fr)); gap:15px; align-items: end; }
    input, select { padding: 10px; border-radius: 6px; border: 1px solid #d1d5db; width: 100%; font-size: 0.9rem; }
    input:focus, select:focus { border-color: #3b82f6; outline: none; box-shadow: 0 0 0 3px rgba(59,130,246,0.1); }
    label { font-size: 0.8rem; font-weight: 600; color: #4b5563; margin-bottom: 4px; display: block; }

    .btn { padding: 10px 16px; border-radius: 6px; border:none; font-weight: 500; cursor: pointer; display: inline-flex; align-items: center; gap: 8px; font-size: 0.9rem; transition: background 0.2s; }
    .btn-primary { background: #3b82f6; color: #fff; } .btn-primary:hover { background: #2563eb; }
    .btn-success { background: #10b981; color: #fff; } .btn-success:hover { background: #059669; }
    .btn-danger { background: #ef4444; color: #fff; } .btn-danger:hover { background: #dc2626; }
    .btn-ghost { background: #f3f4f6; color: #374151; } .btn-ghost:hover { background: #e5e7eb; }

    table { width:100%; border-collapse:collapse; }
    th { text-align: left; padding: 12px 15px; font-size: 0.85rem; color: #6b7280; font-weight: 600; border-bottom: 2px solid #f3f4f6; }
    td { padding: 12px 15px; font-size: 0.9rem; color: #374151; border-bottom: 1px solid #f3f4f6; }
    tr:hover { background: #f9fafb; }

    /* Toast */
    #toast-container { position: fixed; bottom: 20px; right: 20px; z-index: 9999; }
    .toast { background: #1f2937; color: #fff; padding: 12px 20px; border-radius: 8px; margin-top: 10px; display: flex; align-items: center; gap: 10px; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); animation: slideIn 0.3s; }
    @keyframes slideIn { from { transform: translateX(100%); } to { transform: translateX(0); } }

    /* Responsive */
    @media(max-width: 1024px) { .charts-container { grid-template-columns: 1fr; } }
    @media(max-width: 768px) {
      body { flex-direction:column; overflow-y: auto; }
      .sidebar { width:100%; height: auto; padding-bottom: 10px; }
      .brand { display: flex; justify-content: space-between; align-items: center; padding: 15px 20px; border:none; }
      .sidebar ul { display: flex; overflow-x: auto; padding: 0 10px; }
      .sidebar li { white-space: nowrap; margin: 0 5px; background: rgba(255,255,255,0.1); }
      .content { padding: 15px; }
    }
  </style>

  <script src="https://www.gstatic.com/firebasejs/11.0.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/11.0.0/firebase-firestore-compat.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

  <div class="sidebar">
    <div class="brand">
      <div>
        <h2>PAU-MOVs</h2>
        <p>Means of Verification Tracker</p>
      </div>
    </div>
    <ul>
      <li class="active" data-section="dashboard"><i class="fas fa-th-large"></i> Dashboard</li>
      <li data-section="movs"><i class="fas fa-table"></i> MOVs</li>
      <li data-section="reports"><i class="fas fa-chart-bar"></i> Reports</li>
    </ul>
  </div>

  <div class="content">
    <div id="toast-container"></div>

    <section id="dashboard" class="section active">
      <h1>Dashboard</h1>
      <p class="subtitle">Track and manage your Means of Verification</p>

      <div class="stats-grid" id="stats-container">
        </div>

      <div class="charts-container">
        <div class="chart-box">
          <div class="chart-header">
            <h4>Category Distribution</h4>
          </div>
          <canvas id="chartDonut" height="250"></canvas>
        </div>

        <div class="chart-box">
          <div class="chart-header">
            <h4>Monthly Trend</h4>
            <select id="chart-year-filter" style="width: auto; padding: 5px 10px; font-size: 0.8rem;">
              </select>
          </div>
          <canvas id="chartBar" height="120"></canvas>
        </div>
      </div>

      <div class="panel">
        <h3 style="margin-bottom:15px; color:#111827;">Quick Add Entry</h3>
        <div class="input-grid">
          <div><label>Date</label><input type="date" id="input-date" /></div>
          <div><label>Type</label>
            <select id="input-type">
              <option value="IEC Videos">IEC Videos</option>
              <option value="News Release">News Release</option>
              <option value="Photo Release">Photo Release</option>
              <option value="PILU EduAksyon">PILU EduAksyon</option>
              <option value="Social Cards (others)">Social Cards (others)</option>
              <option value="Social Cards (PAU)">Social Cards (PAU)</option>
            </select>
          </div>
          <div><label>Title</label><input type="text" id="input-title" placeholder="Title..." /></div>
          <div><label>Responsible</label><input type="text" id="input-responsible" placeholder="Name..." /></div>
          <div><label>Link</label><input type="url" id="input-link" placeholder="http://..." /></div>
          <div><label>Remarks</label><input type="text" id="input-remarks" placeholder="Optional" /></div>
          <div style="display:flex; gap:10px;">
             <button id="add-mov" class="btn btn-primary" style="width:100%; justify-content:center;">Add</button>
             <label for="upload-excel" class="btn btn-success" style="cursor:pointer;"><i class="fas fa-file-excel"></i></label>
             <input type="file" id="upload-excel" accept=".xlsx,.xls" style="display:none;" />
          </div>
        </div>
      </div>
    </section>

    <section id="movs" class="section">
      <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
        <h1>All Records</h1>
        <div style="display:flex; gap:10px;">
            <input type="text" id="global-search" placeholder="Search..." style="width:200px;">
            <button id="export-excel" class="btn btn-ghost"><i class="fas fa-download"></i></button>
            <button id="deleteSelectedBtn" class="btn btn-danger"><i class="fas fa-trash"></i></button>
        </div>
      </div>
      
      <div class="panel" style="padding:0; overflow:hidden;">
        <div style="overflow-x:auto;">
            <table id="movs-table">
            <thead>
                <tr>
                <th width="40"><input type="checkbox" id="selectAll"></th>
                <th onclick="sortTable('date')">Date <i class="fas fa-sort"></i></th>
                <th onclick="sortTable('type')">Type <i class="fas fa-sort"></i></th>
                <th>Title</th>
                <th>Responsible</th>
                <th>Link</th>
                <th>Actions</th>
                </tr>
            </thead>
            <tbody></tbody>
            </table>
        </div>
      </div>
    </section>

    <section id="reports" class="section">
      <h1>Reports</h1>
      <p class="subtitle">Filter and export specific data sets</p>
      
      <div class="panel">
        <div class="input-grid" style="grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));">
          <div><label>Month</label><input type="month" id="filter-month" /></div>
          <div><label>Category</label>
            <select id="filter-type">
              <option value="">All</option>
              <option value="IEC Videos">IEC Videos</option>
              <option value="News Release">News Release</option>
              <option value="Photo Release">Photo Release</option>
              <option value="PILU EduAksyon">PILU EduAksyon</option>
              <option value="Social Cards (others)">Social Cards (others)</option>
              <option value="Social Cards (PAU)">Social Cards (PAU)</option>
            </select>
          </div>
          <div><label>&nbsp;</label><button id="filter-report" class="btn btn-primary" style="width:100%;">Apply</button></div>
          <div><label>&nbsp;</label><button id="export-report" class="btn btn-success" style="width:100%;">Export</button></div>
        </div>
      </div>

      <div class="panel" style="padding:0;">
        <table id="report-table">
          <thead>
            <tr>
              <th>Date</th>
              <th>Type</th>
              <th>Title</th>
              <th>Responsible</th>
              <th>Link</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

  </div>

<script>
// --- 1. CONFIGURATION ---
const firebaseConfig = {
  apiKey: "AIzaSyBTMtGna6DHyqdSxvmEsIRL-ffWEbR-Cmk",
  authDomain: "pau-movs.firebaseapp.com",
  projectId: "pau-movs",
  storageBucket: "pau-movs.firebasestorage.app",
  messagingSenderId: "502537936923",
  appId: "1:502537936923:web:5f7c97f1469efc9a9b18be",
  measurementId: "G-SCJBGH476G"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const movsColl = db.collection('movs');

// Data State
let movsData = [];
let editingId = null;
let chartDonutInstance = null;
let chartBarInstance = null;

const COLORS = {
  'IEC Videos': { bg: '#dbeafe', border: '#3b82f6', text: '#1e40af', class: 'card-iec', icon: 'fa-video' },
  'News Release': { bg: '#dcfce7', border: '#22c55e', text: '#166534', class: 'card-news', icon: 'fa-newspaper' },
  'Photo Release': { bg: '#fef3c7', border: '#f59e0b', text: '#92400e', class: 'card-photo', icon: 'fa-camera' },
  'PILU EduAksyon': { bg: '#e0f2fe', border: '#0ea5e9', text: '#075985', class: 'card-pilu', icon: 'fa-book-open' },
  'Social Cards (others)': { bg: '#e0e7ff', border: '#6366f1', text: '#3730a3', class: 'card-soc-o', icon: 'fa-th' },
  'Social Cards (PAU)': { bg: '#ccfbf1', border: '#14b8a6', text: '#115e59', class: 'card-soc-p', icon: 'fa-user-friends' }
};

const TYPES = Object.keys(COLORS);

// --- 2. INITIALIZATION ---
window.addEventListener('load', () => {
  document.getElementById('input-date').value = new Date().toISOString().split('T')[0];
  
  // Realtime Sync
  movsColl.orderBy('sortDate', 'desc').onSnapshot(snap => {
    movsData = [];
    snap.forEach(doc => movsData.push({ id: doc.id, ...doc.data() }));
    updateApp();
  });
});

function updateApp() {
  populateYearDropdown();
  renderStatsCards();
  updateCharts();
  renderTable(movsData);
}

// --- 3. DASHBOARD LOGIC ---

// A. Stats Cards
function renderStatsCards() {
  const container = document.getElementById('stats-container');
  const counts = {};
  TYPES.forEach(t => counts[t] = 0);
  
  movsData.forEach(r => {
    if(counts[r.type] !== undefined) counts[r.type]++;
  });

  let html = '';
  // Individual Types
  TYPES.forEach(t => {
    const conf = COLORS[t];
    html += `
      <div class="stat-card ${conf.class}">
        <h3>${t}</h3>
        <div class="value">${counts[t]}</div>
        <i class="icon fas ${conf.icon}"></i>
      </div>
    `;
  });
  
  // Total Card
  html += `
    <div class="stat-card card-total">
      <h3>Total Produced</h3>
      <div class="value">${movsData.length}</div>
      <i class="icon fas fa-chart-line"></i>
    </div>
  `;
  
  container.innerHTML = html;
}

// B. Charts
function populateYearDropdown() {
  const select = document.getElementById('chart-year-filter');
  const currentVal = select.value;
  const years = [...new Set(movsData.map(r => parseDate(r.date).getFullYear()))].sort((a,b)=>b-a);
  
  if(years.length === 0) years.push(new Date().getFullYear());
  
  select.innerHTML = years.map(y => `<option value="${y}">${y}</option>`).join('');
  if(years.includes(parseInt(currentVal))) select.value = currentVal;
}

document.getElementById('chart-year-filter').addEventListener('change', updateCharts);

function updateCharts() {
  const selectedYear = parseInt(document.getElementById('chart-year-filter').value);
  
  // 1. Prepare Data
  const typeCounts = {}; // For Donut
  TYPES.forEach(t => typeCounts[t] = 0);
  
  const monthlyData = {}; // For Bar: [monthIndex][Type] = count
  for(let m=0; m<12; m++) {
    monthlyData[m] = {};
    TYPES.forEach(t => monthlyData[m][t] = 0);
  }

  movsData.forEach(r => {
    const d = parseDate(r.date);
    const y = d.getFullYear();
    const type = r.type;
    
    // Donut uses ALL time data? Or filtered? Usually Dashboard shows current snapshot. 
    // Let's make Donut show All Time, Bar show Monthly Trend for Selected Year.
    if(typeCounts[type] !== undefined) typeCounts[type]++;
    
    if(y === selectedYear && monthlyData[d.getMonth()]) {
        if(monthlyData[d.getMonth()][type] !== undefined) {
            monthlyData[d.getMonth()][type]++;
        }
    }
  });

  // 2. Render Donut (Category Distribution)
  const ctxDonut = document.getElementById('chartDonut').getContext('2d');
  if(chartDonutInstance) chartDonutInstance.destroy();
  
  chartDonutInstance = new Chart(ctxDonut, {
    type: 'doughnut',
    data: {
      labels: TYPES,
      datasets: [{
        data: TYPES.map(t => typeCounts[t]),
        backgroundColor: TYPES.map(t => COLORS[t].border),
        borderWidth: 0
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: { position: 'right', labels: { boxWidth: 12, usePointStyle: true } }
      },
      cutout: '60%'
    }
  });

  // 3. Render Stacked Bar (Monthly Trend)
  const ctxBar = document.getElementById('chartBar').getContext('2d');
  if(chartBarInstance) chartBarInstance.destroy();
  
  const datasets = TYPES.map(t => ({
    label: t,
    data: [0,1,2,3,4,5,6,7,8,9,10,11].map(m => monthlyData[m][t]),
    backgroundColor: COLORS[t].border,
    barPercentage: 0.6,
  }));

  chartBarInstance = new Chart(ctxBar, {
    type: 'bar',
    data: {
      labels: ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'],
      datasets: datasets
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      scales: {
        x: { stacked: true, grid: { display: false } },
        y: { stacked: true, beginAtZero: true, border: { display: false } }
      },
      plugins: {
        legend: { display: false } // Hide legend to save space, colors match donut
      }
    }
  });
}

// --- 4. CRUD & TABLES ---
document.getElementById('add-mov').addEventListener('click', async () => {
  const rec = {
    date: document.getElementById('input-date').value,
    type: document.getElementById('input-type').value,
    title: document.getElementById('input-title').value,
    responsible: document.getElementById('input-responsible').value,
    link: document.getElementById('input-link').value,
    remarks: document.getElementById('input-remarks').value
  };

  if(!rec.title) return showToast('Title is required', 'error');

  try {
    if(editingId) {
      await movsColl.doc(editingId).update({ ...rec, sortDate: parseDate(rec.date), updatedAt: firebase.firestore.FieldValue.serverTimestamp() });
      showToast('Updated successfully');
    } else {
      await movsColl.add({ ...rec, sortDate: parseDate(rec.date), createdAt: firebase.firestore.FieldValue.serverTimestamp() });
      showToast('Added successfully');
    }
    resetForm();
  } catch(e) { showToast(e.message, 'error'); }
});

function resetForm() {
  document.getElementById('input-title').value = '';
  document.getElementById('input-responsible').value = '';
  document.getElementById('input-link').value = '';
  document.getElementById('input-remarks').value = '';
  editingId = null;
  document.getElementById('add-mov').textContent = 'Add';
}

// Table Render
function renderTable(data) {
  const tbody = document.querySelector('#movs-table tbody');
  const search = document.getElementById('global-search').value.toLowerCase();
  
  const filtered = data.filter(d => 
    d.title.toLowerCase().includes(search) || 
    d.responsible.toLowerCase().includes(search)
  );

  tbody.innerHTML = filtered.map(r => `
    <tr data-id="${r.id}">
      <td><input type="checkbox" class="rowCheckbox"></td>
      <td>${r.date}</td>
      <td><span style="font-size:0.8rem; padding:2px 8px; borderRadius:4px; background:${COLORS[r.type]?.bg||'#eee'}; color:${COLORS[r.type]?.text||'#333'}">${r.type}</span></td>
      <td>${r.title}</td>
      <td>${r.responsible}</td>
      <td>${r.link ? `<a href="${r.link}" target="_blank" style="color:#3b82f6;"><i class="fas fa-external-link-alt"></i></a>` : ''}</td>
      <td>
        <button onclick="editItem('${r.id}')" class="btn-ghost" style="padding:4px 8px;"><i class="fas fa-pen"></i></button>
        <button onclick="deleteItem('${r.id}')" class="btn-ghost" style="padding:4px 8px; color:#ef4444;"><i class="fas fa-trash"></i></button>
      </td>
    </tr>
  `).join('');
}

document.getElementById('global-search').addEventListener('input', () => renderTable(movsData));

// Helpers
window.editItem = (id) => {
  const r = movsData.find(d => d.id === id);
  if(r) {
    document.getElementById('input-date').value = r.date;
    document.getElementById('input-type').value = r.type;
    document.getElementById('input-title').value = r.title;
    document.getElementById('input-responsible').value = r.responsible;
    document.getElementById('input-link').value = r.link;
    document.getElementById('input-remarks').value = r.remarks;
    editingId = id;
    document.getElementById('add-mov').textContent = 'Update';
    document.querySelector('[data-section="dashboard"]').click();
  }
};

window.deleteItem = async (id) => {
  if(confirm('Delete record?')) {
    await movsColl.doc(id).delete();
    showToast('Deleted');
  }
};

// Utils
function parseDate(s) {
  if(!s) return new Date();
  // Handle Excel Number
  if(typeof s === 'number') return new Date((s - 25569) * 86400 * 1000);
  return new Date(s);
}

function showToast(msg, type='success') {
  const t = document.createElement('div');
  t.className = 'toast';
  t.innerHTML = `<i class="fas ${type==='success'?'fa-check':'fa-exclamation-circle'}"></i> ${msg}`;
  t.style.borderLeft = `4px solid ${type==='success'?'#10b981':'#ef4444'}`;
  document.getElementById('toast-container').appendChild(t);
  setTimeout(() => t.remove(), 3000);
}

// Navigation
document.querySelectorAll('.sidebar li').forEach(item => {
  item.addEventListener('click', () => {
    document.querySelectorAll('.sidebar li').forEach(i=>i.classList.remove('active'));
    item.classList.add('active');
    document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
    document.getElementById(item.dataset.section).classList.add('active');
  });
});

// Excel Upload Stub (Re-use your logic here)
document.getElementById('upload-excel').addEventListener('change', async (e) => {
    // ... Copy your existing Excel logic here if needed ... 
    // For brevity, using simple success toast
    const file = e.target.files[0];
    if(!file) return;
    try {
        const data = await file.arrayBuffer();
        const workbook = XLSX.read(data, {type:'array'});
        const json = XLSX.utils.sheet_to_json(workbook.Sheets[workbook.SheetNames[0]]);
        let count = 0;
        for(let r of json) {
           // Simple mapping
           await movsColl.add({
               date: r.Date || new Date().toISOString().split('T')[0],
               type: r.Type || 'IEC Videos',
               title: r.Title || 'Imported',
               responsible: r.Responsible || '',
               link: r.Link || '',
               remarks: r.Remarks || '',
               sortDate: new Date(),
               createdAt: new Date()
           });
           count++;
        }
        showToast(`Imported ${count} items`);
    } catch(err) { showToast('Import Error', 'error'); }
});

</script>
</body>
</html>
